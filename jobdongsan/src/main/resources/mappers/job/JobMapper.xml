<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.jobdongsan.project.dao.IJobDAO">
  	<resultMap id="jobResult" type="com.jobdongsan.project.model.JobVO" >
  		<result property="jobNo" column="jobNo" />
  		<result property="jobName" column="jobName" />
  		<result property="jobInfo" column="jobInfo" />
  		<result property="jobImg" column="jobImg" />
  		<result property="jobWork" column="jobWork" />
  		<result property="jobHow" column="jobHow" />
  		<result property="jobNeeds" column="jobNeeds" />
  		<result property="jobValues" column="jobValues" />
  		<result property="jobCtg" column="jobCtg" />
  		<result property="categoryNo" column="categoryNo" />
  	</resultMap>
  	
  	<!-- 전체 직업 출력 -->
  	<select id="listAllJob" resultMap="jobResult">
  		SELECT * FROM job ORDER BY jobNo
  	</select>
  	
  	<!-- 직업 상세 정보 조회 -->
  	<select id="detailViewJob" parameterType="int" resultType="com.jobdongsan.project.model.JobVO">
  		<!-- SELECT * FROM job
  		WHERE jobNo=#{jobNo} -->
  		SELECT j.jobNo, j.jobName, j.jobInfo, j.jobImg, j.jobWork, j.jobHow, j.jobNeeds, j.jobValues, j.jobCtg, c.categoryNo, c.categoryName, c.categoryImg
  		FROM job j, category c
  		WHERE j.categoryNo = c.categoryNo AND j.jobNo=#{jobNo}
  	</select>
  	
  	<!-- 직업 검색 -->
  	<select id="jobSearch" parameterType="string" resultMap="jobResult">
  		SELECT * FROM job WHERE
  			<choose>
  				<when test="type != null and type.equals('jobName')">
  					jobName LIKE CONCAT('%', #{keyword}, '%')
  				</when>
  			</choose>
  	</select>
  	
  	<!-- 마이페이지에 동일 찜직업이 존재하는지 확인 -->
  	<select id="jobCheck" parameterType="hashmap" resultType="int">
  		SELECT COUNT(*)
  		FROM my_history
  		WHERE jobNo=#{jobNo} AND memId=#{memId}
  	</select>
  	
  	<!-- 찜직업 추가  -->
  	<insert id="jobInsert" parameterType="com.jobdongsan.project.model.MyHistoryVO">
  		INSERT INTO my_history (memId, jobNo)
  		VALUES(#{memId}, #{jobNo})
  	</insert>
  	
  	<!-- 찜직업 삭제 -->
  	<delete id="jobDelete" parameterType="int">
  		DELETE
  		FROM my_history
  		WHERE jobNo=#{jobNo}
  	</delete>
  
  </mapper>